<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">

        <link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.9.0/fullcalendar.min.css' />
	    <!--<script src='https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js'></script>-->
	    <script src='https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.21.0/moment.min.js'></script>
        <script src='https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.9.0/fullcalendar.min.js'></script>
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>


        <!--
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
        
        <link rel="stylesheet" href="../CSS/calendar.css">
        <link rel="stylesheet" href="../CSS/calSize.css">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
        -->
        <!--<script src="../JS/CalendarJS.js" defer></script>-->
        
        <!--
        <script>
            $(function(){
                var om1360 = [];

                $.getJSON('../LabData/om1360.json', function(arr){
                    $.each(arr.om1360, function(i, f){
                        var tblRow = "<tr>" + "<td>" + f.name + "</td>" + 
                                              "<td>" + f.start + "</td>" +
                                              "<td>" + f.end + "</td>" + "</tr>"
                        $(tblRow).appendTo("#cal")
                    })
                })
            });
        </script>
    -->








    <script>
        var url1 = new URL(window.location.href)
        var room = "OM1360";
        console.log(typeof url1.searchParams);
        if(typeof url1.searchParams != 'undefined'){
        	room = url1.searchParams.get("room");
        	
        	room = room == null ? 'OM1360' : room;
        }
        var JSLink = "http://takip.me/CampusCompanion/LabData/" + room + ".json";
        schedule = '';

        var JSElement = document.createElement('script');
        JSElement.src = JSLink;
        JSElement.onload = OnceLoaded;
        document.getElementsByTagName('head')[0].appendChild(JSElement);

        window.addEventListener('error', function(e) {
            if (room == null) {
                alert('after the url type ?room={classroom}')
                document.getElementById('calendar').innerHTML = 'Refresh to show changes';
            } else
                document.getElementById('calendar').innerHTML = 'It brokez';
        }, true);

        function OnceLoaded() {

            $('#calendar').fullCalendar({
                //themeSystem: 'jquery-ui',
                header: {
                    left: 'prev,next today',
                    center: 'title',
                    right: 'month,agendaWeek,agendaDay,listWeek'
                },
                navLinks: true, // can click day/week names to navigate views
                nowIndicator: true,
                editable: false,
                eventLimit: true, // allow "more" link when too many events
                eventClick: function(calEvent, jsEvent, view) {
                    var start_date = moment(calEvent.start).format('DD/MM/YYYY HH:mm');
                    var end_date = moment(calEvent.end).format('DD/MM/YYYY HH:mm');
                    alert('Course: ' + calEvent.title + '\nStart: ' + start_date + '\nEnd: ' + end_date);
                },
                height: 'auto',
                defaultView: 'month',
                weekNumbers: true,
                events: schedule
            });
            dropdown();
        }

        function dropdown() { // wait for page to load
            var cityDropdown = $("#rooms"),
                countryDropdown = $('<select></select>'), // create a country dropdown
                countries = ['OM', 'AHT', 'AE', 'WL', 'CTT', 'S', 'IB', 'HOL', 'OL']; // ordered list of countries

            // parse the nested dropdown
            cityDropdown.children().each(function() {
                var group = $(this),
                    countryName = group.attr('label'),
                    option;

                // create an option for the country
                option = $('<option></option>').text(countryName);

                // store the associated city options
                option.data('cities', group.children());

                // check if the country should be selected
                if (group.find(':selected').length > 0) {
                    option.prop('selected', true);
                }

                // add the country to the dropdown
                countryDropdown.append(option);
            });

            // add the country dropdown to the page
            cityDropdown.before(countryDropdown);

            // this function updates the city dropdown based on the selected country
            function updateCities() {
                var country = countryDropdown.find(':selected');
                cityDropdown.empty().append(country.data('cities'));
                console.log(country[0].innerHTML);
            }

            function updateRoom() {
                var room = cityDropdown.find(':selected')[0].innerHTML ;
                console.log(room);
                $.getScript("http://takip.me/CampusCompanion/LabData/" + room + ".json", function(){
                	console.log(schedule);
                	$('#calendar').fullCalendar( 'removeEvents');
					$('#calendar').fullCalendar( 'addEventSource', schedule );
                });

			}


            // call the function to set the initial cities
            updateCities();

            // and add the change handler
            countryDropdown.on('change', updateCities);
            cityDropdown.on('click', updateRoom);
        }
    </script>









    </head>

    <body>

        <nav class="navbar navbar-expand-md navbar-light" style="background-color: #003e51;">

            <a class="navbar-brand" href="home.html" style="color: white">TRU Campus Companion</a>
            <button class="navbar-toggler" type="button" style="background-color: white;" data-toggle="collapse" data-target="#collapsibleNavbar">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="collapsibleNavbar">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link" style="color: white;" href="HTML/profInfo.html">Professor Information</a>
                    </li>
                    <li class="nav-item">
                            <a class="nav-link" style="color: white;" href="HTML/lab.html">Computer Lab Information</a>
                    </li>
                    <li class="nav-item">
                            <a class="nav-link" style="color: white;" href="HTML/software.html">Lab Software</a>
                    </li>
                    <li class="nav-item">
                            <a class="nav-link" style="color: white;" href="HTML/amenities.html">Facilities and Amenities</a>
                    </li>
                    <li class="nav-item">
                            <a class="nav-link" style="color: white;" href="HTML/services.html">Campus Services</a>
                    </li>
                    <li class="nav-item">
                            <a class="nav-link" style="color: white;" href="HTML/food.html">Food and Drink</a>
                    </li>
                </ul>
            </div>
        </nav>
        <br>

        <select id="rooms">

            <optgroup label="AE">
                <option>AE151</option>
                <option>AE361</option>
            </optgroup>

            <optgroup label="IB">
                <option>IB2006</option>
            </optgroup>

            <optgroup label="OM">
                <option>OM1325</option>
                <option>OM1327</option>
                <option>OM1330</option>
                <option>OM1335</option>
                <option>OM1340</option>
                <option>OM1345</option>
                <option>OM1350</option>
                <option>OM1355</option>
                <option>OM1360</option>
            </optgroup>
            
            <optgroup label="S">
                <option>S232</option>
            </optgroup>
            
            <optgroup label="TT">
                <option>TT253</option>
                <option>TT254</option>
                <option>TT255</option>
            </optgroup>
            
        </select>
                <ul id='calendar'>
    </body>
</html>